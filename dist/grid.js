define("kjui/grid/0.0.1/grid",["$","gallery/underscore/1.4.2/underscore","gallery/handlebars/1.0.0/handlebars","arale/widget/1.0.2/widget","arale/base/1.0.1/base","arale/class/1.0.0/class","arale/events/1.0.0/events"],function(e,t,n){var r=e("$"),i=e("gallery/underscore/1.4.2/underscore"),s=e("gallery/handlebars/1.0.0/handlebars"),o=e("arale/widget/1.0.2/widget"),u='{{#if title}} <div class="hd unselectable"> <span class="hd-title">{{title}}</span> </div> {{/if}} <div class="bd" style="background-color:white;"> <table class="grid grid-with-row-lines" border="0" cellspacing="0" cellpadding="0"> <thead class="grid-hd unselectable"> <tr> {{#each fields}} <td class="grid-hd-cell" data-name="{{name}}"{{#if width}} width="{{width}}"{{/if}}> <span>{{header}}</span> </td> {{/each}} </tr> </thead> <tbody> {{#each records}} <tr class="grid-row{{#if isAlt}} grid-row-alt{{/if}}" data-id="{{id}}"> {{#each values}} <td class="grid-cell">{{{.}}}</td> {{/each}} </tr> {{/each}} </tbody> </table> <div class="toolbar toolbar-ft"> <i class="icon icon-btn {{#if isFirst}}icon-btn-is-disabled icon-grid-page-first-disabled{{else}}icon-grid-page-first{{/if}}" data-role="first"></i> <i class="icon icon-btn {{#if hasPrev}}icon-grid-page-prev{{else}}icon-btn-is-disabled icon-grid-page-prev-disabled{{/if}}" data-role="prev"></i> <i class="toolbar-separator"></i> <span class="toolbar-text">当前第</span> <input class="form-text" style="width:40px;" type="text" data-role="num"> <span class="toolbar-text">/10页</span> <i class="toolbar-separator"></i> <i class="icon icon-btn {{#if hasNext}}icon-grid-page-next{{else}}icon-btn-is-disabled icon-grid-page-next-disabled{{/if}}" data-role="next"></i> <i class="icon icon-btn {{#if isLast}}icon-btn-is-disabled icon-grid-page-last-disabled{{else}}icon-grid-page-last{{/if}}" data-role="last"></i> <i class="toolbar-separator"></i> <i class="icon icon-btn icon-grid-refresh" data-role="refresh"></i> <span class="toolbar-text" style="float:right;margin-right:100px;">共{{totalCount}}条记录，每页{{pageSize}}条</span> </div> </div>',a=o.extend({attrs:{rowHeight:23},events:{"click .grid-hd":"sort","click .grid-row":"click","click :not(.icon-btn-is-disabled)[data-role=prev]":"prevPage","click :not(.icon-btn-is-disabled)[data-role=next]":"nextPage","click :not(.icon-btn-is-disabled)[data-role=first]":"firstPage","click :not(.icon-btn-is-disabled)[data-role=last]":"lastPage","click [data-role=refresh]":"refresh","keyup [data-role=num]":"gotoPage"},sort:function(e){var t=r(e.target).closest("td"),n=t.attr("data-name");this.oldSortHeader?this.oldSortHeader.attr("data-name")!==n&&(this.oldSortHeader.removeClass("grid-hd-is-desc grid-hd-is-asc"),this.oldSortHeader=t):this.oldSortHeader=t,t.hasClass("grid-hd-is-desc")?(t.removeClass("grid-hd-is-desc").addClass("grid-hd-is-asc"),console.log(n,"asc")):(t.removeClass("grid-hd-is-asc").addClass("grid-hd-is-desc"),console.log(n,"desc"))},click:function(e){var t=r(e.target),n=t.parents("tr"),s=n.attr("data-id"),o=i.find(this.data.result,function(e){return e.id=s});this.trigger("click",o,t,n)},prevPage:function(){var e=this.data.prevPage;this.fetch(e)},nextPage:function(){var e=this.data.nextPage;this.fetch(e)},firstPage:function(){var e=this.data.firstPage;this.fetch(e)},lastPage:function(){var e=this.data.lastPage;this.fetch(e)},refresh:function(){var e=this.data.pageNumber;this.fetch(e)},gotoPage:function(e){var t=r(e.target),n=t.val();if(n&&e.which==13)this.fetch(n);else{n=n.replace(/\D/g,"");if(n){n=parseInt(n,10);var i=this.data.totalPages;n>i?n=i:n===0&&(n=1),t.val(n)}else t.val("")}},fetch:function(e){var t=this,n=this.urlFormat(e);r.getJSON(n,function(e){t._createGrid(e.data)})},urlFormat:function(e){return e},setup:function(){var e=this;a.superclass.setup.call(this);var t=this.get("url");if(t)r.getJSON(t,function(t){e._createGrid(t.data)});else{var n=this.get("data");n&&this._createGrid(n)}},_createGrid:function(e){this.data=e;var t=this.get("title"),n=this.get("fields"),o=r.map(e.result,function(e,t){return{isAlt:t%2===1,id:e.id,values:r.map(n,function(t){var n=e[t.name];return n=i.escape(n),r.isFunction(t.render)?t.render(n):n})}}),a=s.compile(u)({title:t,fields:n,records:o,isFirst:function(){return e.pageNumber<=1},isLast:function(){return e.totalPages===0||e.pageNumber===e.totalPages},hasPrev:e.hasPrev,hasNext:e.hasNext,totalCount:e.totalCount,pageSize:e.pageSize});this.element.html(a),this.$("[data-role=num]").val(e.pageNumber),this._fixFooterPosition()},_fixFooterPosition:function(){var e=this.get("rowHeight")*(this.data.pageSize-this.data.result.length);this.$(".grid-ft").css("margin-top",e)}});n.exports=a});